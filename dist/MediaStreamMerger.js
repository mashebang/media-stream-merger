!function(t){var e={};function s(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(r,a,function(e){return t[e]}.bind(null,a));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);e.default=class{constructor(t){this.addStream=((t,e)=>{t.id;const s=document.createElement("video");s.muted=!0,s.autoplay=!0,s.srcObject=t;const{size:r,size:{width:a,height:i},renderCoordinates:n,mute:c=!0}=e;(a>this.canvas.width||i>this.canvas.height)&&(this.canvas.height=i,this.canvas.width=a),this.streams.push({video:s,size:r,renderCoordinates:n}),c||t.getAudioTracks().forEach(t=>this.audioTracks.push(t))}),this.normalizeRenderCoordinates=((t,e)=>{const{width:s=this.canvas.width,height:r=this.canvas.height}=e,a={startX:0,startY:0};return t?t?{startX:t.x,startY:t.y}:void 0:(this.canvas.width>=s&&(a.startX=(this.canvas.width-s)/2),this.canvas.height>=r&&(a.startY=(this.canvas.height-r)/2),a)}),this.injectAudioToStream=(t=>{this.audioTracks.forEach(e=>{t.addTrack(e)}),this.result=t}),this.clearCanvas=(()=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.cleanerCounter=0}),this.draw=(()=>{if(!(this.streams.length>1))return this.result=this.streams[0].srcObject,void(this.callback&&this.callback());this.cleanerCounter>200&&this.clearCanvas(),this.streams.forEach(t=>{const{video:e,size:s,size:{width:r,height:a},renderCoordinates:i}=t,{startX:n,startY:c}=this.normalizeRenderCoordinates(i,s);this.context.drawImage(e,n,c,r,a)}),this.firstCall&&(this.firstCall=!1,this.injectAudioToStream(this.canvas.captureStream()),this.callback&&this.callback(this.result)),this.cleanerCounter++,requestAnimationFrame(this.draw)}),this.start=(t=>{this.callback=t,this.draw()}),this.stopTracks=(()=>{this.streams.forEach(t=>t.video.srcObject.getTracks().forEach(t=>t.stop())),this.audioTracks.forEach(t=>t.stop())}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.streams=[],this.audioTracks=[],this.cleanerCounter=0,this.firstCall=!0,this.result=null}}}]);