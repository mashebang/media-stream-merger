!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("MediaStreamMerger",[],e):"object"==typeof exports?exports.MediaStreamMerger=e():t.MediaStreamMerger=e()}(window,function(){return function(t){var e={};function r(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);e.default=class{constructor(t){this.addStream=((t,e)=>{t.id;const r=document.createElement("video");r.muted=!0,r.autoplay=!0,r.srcObject=t,r.play().then(()=>console.log("[media-stream-merger]: stream video is playing -> ",t.id)).catch(e=>console.error("[media-stream-merger]: some error ocurred on playing stream video -> ",t.id));const{size:s,size:{width:i,height:a},renderCoordinates:n,mute:o=!0}=e;(i>this.canvas.width||a>this.canvas.height)&&(this.canvas.height=a,this.canvas.width=i),this.streams.push({video:r,size:s,renderCoordinates:n}),o||t.getAudioTracks().forEach(t=>this.audioTracks.push(t))}),this.normalizeRenderCoordinates=((t,e)=>{const{width:r=this.canvas.width,height:s=this.canvas.height}=e,i={startX:0,startY:0};return t?t?{startX:t.x,startY:t.y}:void 0:(this.canvas.width>=r&&(i.startX=(this.canvas.width-r)/2),this.canvas.height>=s&&(i.startY=(this.canvas.height-s)/2),i)}),this.injectAudioToStream=(t=>(this.audioTracks.forEach(e=>{t.addTrack(e)}),t)),this.clearCanvas=(()=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.cleanerCounter=0}),this.draw=(()=>{if(!(this.streams.length>1))return this.result=this.streams[0].srcObject,void(this.callback&&this.callback(this.result));this.cleanerCounter>200&&this.clearCanvas(),this.streams.forEach(t=>{const{video:e,size:r,size:{width:s,height:i},renderCoordinates:a}=t,{startX:n,startY:o}=this.normalizeRenderCoordinates(a,r);this.context.drawImage(e,n,o,s,i)}),this.firstCall&&(this.firstCall=!1,this.result=this.injectAudioToStream(this.canvas.captureStream()),this.callback&&this.callback(this.result)),this.cleanerCounter++,requestAnimationFrame(this.draw)}),this.start=(t=>{this.callback=t,this.draw()}),this.stopTracks=(()=>{this.streams.forEach(t=>t.video.srcObject.getTracks().forEach(t=>t.stop())),this.audioTracks.forEach(t=>t.stop())}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.streams=[],this.audioTracks=[],this.cleanerCounter=0,this.firstCall=!0,this.result=null}}}])});